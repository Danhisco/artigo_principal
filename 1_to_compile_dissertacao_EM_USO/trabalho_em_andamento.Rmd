---
output: html_document
editor_options: 
  chunk_output_type: console
---

# 10dez2024

CPF: escrever:
1) métrica funcional
2) tabelas comparação modelos estatísticos
3) diagnóstico dos modelos -TO AQUI 
4) predição a posteriori
5) sumário










# 12/06/2024

Arrumando o diretório de MNEE taxa U correspondente 

```{r}
path_repo <- "./dados/csv/SADs_neutras/MNEE_taxaU_correspondente"
# 1) padronização do sistema de pasta e nomes
df_move <- mutate(data.frame(
  SADrep.path = list.files(path=path_repo,
                           pattern=".csv",full.names = TRUE,recursive=T)),
  SiteCode = str_extract(SADrep.path,"(?<=/(cont|ideal|non_frag)/)[^/]+(?=\\.csv)"),
  land_type = str_extract(SADrep.path,"(cont|non_frag|ideal)") %>% gsub("cont","contemp",.),
  SADrep_newpath = paste0(path_repo,"/",land_type,"__",SiteCode,".csv")
  )
a_ply(df_move,1,\(i){
  file.rename(i$SADrep.path,i$SADrep_newpath)
})
# 2) mudança dos arquivos para as respectivas pastas
path_repo <- "./dados/csv/SADs_neutras/MNEE_taxaU_correspondente"
df_move <- mutate(data.frame(
  SADrep.path = list.files(path=path_repo,
                           pattern=".csv",full.names = TRUE,recursive=T)),
  SiteCode = str_extract(SADrep.path,"(?<=__).*?(?=\\.csv)"),
  land_type = str_extract(SADrep.path,"(contemp|non_frag|ideal)"),
  SADrep_newpath = str_replace(SADrep.path,"correspondente",land_type)
  )
a_ply(df_move,1,\(i){
  file.rename(i$SADrep.path,i$SADrep_newpath)
})
# 3) auditoria
## 1) existem o mesmo número de SADs réplicas em cada subpasta?
path_repo <- "dados/csv/SADs_neutras/"
v_dirs <- list.dirs(path_repo,full.names = FALSE)
v_dirs <- v_dirs[v_dirs!=""] #? 
sapply(v_dirs,\(i){
  v_files <- list.files(path=paste0(path_repo,i))
  length(v_files)
})
## 2) os nomes são os mesmos?
l_names <- lapply(v_dirs,\(i){
  list.files(path=paste0(path_repo,i))
})
setdiff(l_names[[1]],l_names[[2]])
setdiff(l_names[[2]],l_names[[1]])
setdiff(l_names[[1]],l_names[[3]])
setdiff(l_names[[3]],l_names[[1]])
setdiff(l_names[[2]],l_names[[3]])
setdiff(l_names[[3]],l_names[[2]]) #sim

```

Concluo que é possível realizar as comparações das SADs simuladas com a observada

```{r}
df_SADrep <- mutate(data.frame(
  SADrep.path = list.files(path = "dados/csv/SADs_neutras/MNEE",
                           pattern = ".csv",full.names = T,recursive = T)),
  SiteCode = str_extract(SADrep.path,"(?<=[cont|frag|ideal]\\/).*?(?=.csv)"),
  land_type = str_extract(SADrep.path,"(?<=MNEE\\/).*?(?=\\/)"),
  SADobs.path = paste0("dados/csv/SADs_observadas/",SiteCode,".csv"))
f_leitura_SADs <- \(v_path="dados/csv/SADs_neutras/MNEE"){
  mutate(data.frame(
  SADrep.path = list.files(path = v_path,
                           pattern = ".csv",full.names = T,recursive = T)),
  SiteCode = str_extract(SADrep.path,"(?<=[cont|frag|ideal]\\/).*?(?=.csv)"),
  land_type = str_extract(SADrep.path,"(?<=MNEE\\/).*?(?=\\/)"),
  SADobs.path = paste0("dados/csv/SADs_observadas/",SiteCode,".csv"))
}


```




# 9/jun/2024

```{r}
df_simSAD <- inner_join(
  df_sim %>% filter(land_type=="ideal") %>% select(-land_type),
  read_csv(U_path) %>% filter(land_type!="ideal")
  ) %>% select(-Usd)
```

```{r}
f_writeSADcsv <- function(df_bySite, land_matrix = FALSE,
                          n_replicas=100, path_csv){
  f_adply <- \(X) f_simSAD(df_1row = X, land_mat = land_matrix,n = n_replicas)
  m_SADreplicas <- adply(df_bySite,1,f_adply)
  write_csv(select(m_SADreplicas,-c(d:Umed)),
            file = paste0(path_csv,df_bySite$SiteCode[1],".csv"))
}

```



#### SCORES

# 19 maio 2024

Não há consenso com PI sobre se iremos realizar uma comparação de ontologias ou apenas dentro de ontologias. Portanto, o consenso é sobre o densenvolvimento epistemológico alinhado com uma mesma ontologia. Assim, vou começar a trabalhar com os dados da taxa U

#### ensaios

# Sistema de referência de diferentes ontologias

Um modelo neutro espacialmente explícito (MNEE) pode ser parte de um sistema de referência no qual é possível contrastar simulações de contrafactuais alinhados a cada ontologia proposta no debate dentro da ecologia de paisagens.
Aqui definimos um sistema de referência em duas partes relacionadas: um dispositivo de mimize de um mecanismo causal suficiente para reconstruir com realismo teórico os dados, no qual é possível calibrar empiricamente os processos demográficos de baixo nível que resultaram no padrão empírico de alto nível que pdoe ser empiricamente validado; e aqueles que propõe os contrastes entre contrafactuais que avaliam os efeitos dentro do proposto processo gerador dos dados (REF).

Nosso sistema de referência pressupõe equilíbrio da dinâmica ecológica na paisagem simulada e pressupomos

Encontramos um métdo equivalente ao da taxa U no qual usamos um dado local para obter um valor da paisagem (a riqueza local e a taxa U) para a área ao redor que influencia a comunidade local, ou seja, não havia um método para obter a paisagem local. Aqui aproveitamos essa propriedade de U para estimar a paisagem local que estabiliza o efeito de escalar em termos da parcela amostrada e paisagem local (APENDICE). 


Talvez o único acordo pragmático possível entre os praticantes de cada ontologia seja sobre a descrição dos padrões, para além disso, inferência causal, proposta de política pública, etc, os programas de pesquisa devem não apresentar acordo pragmático.
Sob a perspectiva dominantes na análise causal de dados observacionais e experimentais (PEARL 2018), o método adequado para avaliar a questão é o de modelo de causas estruturadas que é traduzível em modelo de equações diferenciais (REF). Dentro dessa perspectiva os independentes estão caminhando para a extinção enquanto programa de pesquisa. 
Talvez uma abordagem causal para os independentes seja métodos de pareamento de casos (paisagens) ou o de experimentos na escala da paisagem (REF).

Um caminho possível é do sincretismo ontológico, hibridização das ontologias. Em muitas situações o sincretimos é resultado de um prcesso de mudança do status do sujeito/programa de pesquisa, alguma ontologia pode ter seus elementos tomados por outra ontologia, enquanto a original deixa de ter status de científica (REF). Em outros casos é possível coexistir as ontologias. 





# História recente do debate na ecologia de paisagens:

1) Revisões conflitantes das evidências: Haddad et al. (2015) e Fahrig (2017)
2) Revisões confitantes dos conceitos: Fletcher Jr et al. (2018) e Fahrig (2019)
3) Hibridização de modelos:
a) Watling et al. 2020: A existência do efeito de perda de habitat é consenso, então qual a métrica mais adequada para a representação desse efeito? A proporção de cobertura florestal remanescente, obtida uma vez que se define paisagem ao redor da área amostral? Ou o tamanho do fragmento amostrado e seu grau de isolamento, obtidas uma vez que se define o fragmento amostrado? Para múltiplas escalas da paisagem ao redor os autores encontraram que os modelos estatísticos que utilizam a proporção de cobertura remanescente como preditor da riqueza local apresentam menor AICc do que aqueles que utilizam as métricas definidas a partir do fragmento amostrado. Possível conclusão, "para compreender a escala local é melhor definir o problema na escala da paisagem - apesar de não saber uma boa forma de definir a paisagem ao redor de uma amostra de múltiplas espécies. Uma conclusão é de suporte para a hipótese da quantidade de habitat no qual 
b) Pütkker et al. 2020: É possível usar as mesmas métricas exploradas por Fahrig 2017 dentro de um modelo de causas estruturadas e explorar a possibilidade de interdependência nos efeitos da perda de habitat e da métrica de fragmentação per se. Ao utilizar tais métricas é necessário definir uma paisagem ao redor. 


Um momento chave do debate é o contraste das concluões entre as revisões dos experimentos de fragmentação tratados na escala do fragmento florestal de Haddad et al. (2015) e dos estudos que avaliaram fragmentação na escala da paisagem por Fahrig (2017) (Valente et al. 2023). A conclusão da revisão dos experimentos foi de que fragmentação de habitat possui efeito com grande magnitude e negativo na biodiversidade remanescente (Haddad et al. 2015), enquanto a conclusão da revisão dos estudos foi de que a fragmentação de habitat não apresenta efeito relevante e quando apresenta é em geral positivo (Fahrig 2017). Essas conclusões partem de concepções distintas do fenomeno em estudo (Didham et al. 2011; Fahrig 2018). Na revisão dos experimentos é pressuposto que existe um processo que remove o habitat natural, modificando concomitantemente a quantidade de habitat e a complexidade espacial do habitat remanescente (Didham et al. 2011, Valente 2023). Na revisão dos estudos no nível da paisagem é pressuposto que existe um processo de redução de perda de habitat que determina a quantidade de habitat remanescente e outro processo de fragmentação per se que aumenta a complexidade espacial do habitat remanescente (Fahrig 2019, Valente 2023). Não há uma avaliação dos dois processos geradores dos dados em uma única análise.

Aqui 



Esse momento de contraste é marcado pelas revisões de conceitos, análises e hipóteses de cada grupo se perguntando se a fragmentação de habitat é boa ou ruim (Fletcher Jr. et al. 2018; Fahrig et al. 2019). Em resumo, Fletcher Jr. et al. (2018) conclui que as revisões dos estudos na escala da paisagem deveriam usar modelos de causals estruturadas para estimar os possíveis efeitos diretos e indiretos da perda de habitat e fragmentação per ser para estimarem os efeitos médios causais e não os efeitos médios de associação. Em esumo, Fahrig et al. (2019) conclui que a extrapolação de conclusões da escala do fragmento amostrado para a escala da paisagem amostrada se configura como hipótese e deve ser testada





Uma vez que os estudos diferem na conceitualização do processo gerador dos dados, o desenho de análise e as métricas escolhidas também diferem (Fletcher Jr. et al. 2018; Fahrig et al. 2019; Valente et al. 2023). 