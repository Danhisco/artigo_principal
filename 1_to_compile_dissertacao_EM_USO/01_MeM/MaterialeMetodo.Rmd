---
title: "Metodologia"
output:
  bookdown::pdf_document2:
    latex_engine: lualatex
  word_document: default
  bookdown::word_document2: default
  pdf_document:
    latex_engine: xelatex
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: console
bibliography: /home/danilo/Documentos/mestrado_Ecologia/artigo_principal/1_to_compile_dissertacao_EM_USO/resources/citations2.bib
csl: /home/danilo/Documentos/mestrado_Ecologia/artigo_principal/1_to_compile_dissertacao_EM_USO/resources/ecological-monographs.csl
---

```{r setup,include=FALSE}
knitr::opts_chunk$set(echo = FALSE, tidy = FALSE, include = TRUE, warning = FALSE,cache = TRUE,message=FALSE,eval=TRUE,dev = 'jpeg',root.dir = '/home/danilo/Documentos/mestrado_Ecologia/artigo_principal')
options(knitr.table.format = "simple")
# pacotes adicionais´
source("source/mapa_p_MNEE.R")
library(doMC)
library(readr)
library(scales)
# library(kableExtra)
library(ggnewscale)
library(gridExtra)
library(ggplot2)
library(tidyr)
library(readr)
library(stringr)
library(plyr)
library(dplyr)
# dados disponíveis
df_dados <- read_csv(file = "dados/df_dados_disponiveis.csv")
df_sim <- read_csv("dados/df_simulacao.csv")
df_plot <- read_csv("dados/csv/df_plotSoE.csv") |> 
  mutate(k_factor=factor(round(k_factor,2)))
df_p_extensoes <- read_csv("dados/csv/df_p_extensoes.csv")
```

```{r trackdown rotine, include=FALSE,eval=FALSE}
# pacotes
library(trackdown)
# both overwrite: 
# overwrite the current google drive file with the current Rmd:
upload_file(file="secoes_texto/MeM/MaterialeMetodo.Rmd",
            gpath="mestrado/artigo_principal/secoes_texto/",
            hide_code=TRUE)
update_file(file ="1_to_compile_dissertacao_EM_USO/01_MeM/MaterialeMetodo.Rmd",
            gpath = "mestrado/artigo_principal/secoes_texto/",
            hide_code = TRUE)
# overwrite the current Rmd with the current google drive 
download_file(file = "1_to_compile_dissertacao_EM_USO/01_MeM/MaterialeMetodo.Rmd",
              gpath = "mestrado/artigo_principal/secoes_texto/")
```

## Overview

<p>A estimativa dos efeitos causais propostos ocorre por meio da interação de duas partes principais. A primeira parte é o modelo neutro espacialmente explícito, que, após ser empiricamente calibrado, funciona como um dispositivo de aproximação do processo gerador dos dados observados (@gianluca_ch4_2022). A segunda parte envolve programas de pesquisa que escolhem contrafactuais, cujos contrastes em pares oferecem interpretações sobre como a perda de cobertura florestal influencia a biodiversidade remanescente (@bull2021; @valente_toward_2023).</p>
  
  
<p>Cada contraste de pares de contrafactuais permite interpretar o específico efeito proposto da paisagem na conectividade e na congruência com a evidência empírica. O contraste entre a calibração empírica dos processos demográficos, ajustado para simular a riqueza observada, foi interpretado como uma métrica funcional de conectividade relacionada à manutenção da riqueza local (logU/U). Já o contraste na congruência da distribuição de abundâncias das espécies da parcela (SAD) simulado com a SAD observada foi interpretado como métrica do efeito da paisagem na descrição da evidência empírica. Este sistema foi aplicado aos sítios de amostragem da base TreeCo (@de_lima_how_2015), conforme critérios de seleção pré-estabelecidos.</p>
  
  
<p>Para cada sítio, exploramos o efeito escalar da dispersão em MNEE, simulando 20 graus de de dispersão, variando a proporção de propágulos que permanecem nas proximidades imediatas da árvore progenitora (parâmetro k). Em cada grau de limitação de dispersão, avaliamos a escala espacial mínima necessária para que a simulação não seja influenciada pela escala de observação da paisagem ao redor da parcela (@fletcher_jr_addressing_2023; @jackson_are_2015). Dessa forma, cada grau de limitação de dispersão foi simulado em sua respectiva extensão espacial suficiente.</p>
  
    
Os resultados foram sumarizados utilizando modelos de regressão hierárquicos (@Pedersen2019). Esses modelos de regressão descrevem os efeitos propostos da paisagem por sítio de amostragem e e o efeito médio comum entre os sítios, em função das métricas de conectividade funcional (logU/U) e de dispersão (k).
  
    
Nas próximas subseções da metodologia, apresentaremos: (i) a base de dados e os critérios de inclusão utilizados (evidência empírica); (ii) as justificativas para o uso do modelo neutro espacialmente explícito como dispositivo de mimese (validação teórica); (iii) a relação entre calibração e validação empírica; e (iv) a análise dos dados, incluindo a racionalidade do contraste entre contrafactuais. Na tabela 2 há o resumo dos procedimentos metodológicos necessários para obter os resultados finais.  
  

```{r tabela 2}
dados_tabela <- data.frame(
  Procedimento = c(
    "1. Coleta de dados", "1.1 Seleção na base TreeCo", "1.2 Seleção de mapas MapBiomas",
    "2. Preparação para simulação", "2.1 Adequação dos mapas", "2.2 Estimativa dos coeficientes de dispersão",
    "3. Efeito escalar da dispersão no mecanismo simulado", "3.1 Sorteio de sítios", 
    "3.2 Estimativa da taxa U", "3.3 Descrição estatística", "3.4 Definição da extensão suficiente",
    "4. Construção de paisagens hipotéticas", "4.1 Réplicas dos mapas", "4.2 Paisagens aglomerada e prístina",
    "5. Simulação das SADs contrafactuais", "5.1 Estimativa da taxa U", "5.2 Geração de SADs",
    "6. Contraste de contrafactuais", "6.1 log(U/U)", "6.2 log(OR)", 
    "7. Análise estatística", "7.1 Ajuste de modelos HGAM", "7.2 Comparação de modelos", 
    "7.3 Inferência", "7.4 Predição a posteriori"
  ),
  Descricao = c(
    #1.
    "",
    #1.1
    "Seleção de dados de inventários florestais registrados na base TreeCo, abrangendo sítios amostrados ao longo de gradientes de riqueza e número de indivíduos.",
    #1.2
    "Escolha de mapas da Coleção 6 do MapBiomas para representar a cobertura florestal contemporânea em cada sítio amostrado.",
    # 2.
    "",
    #2.1
    "Conversão dos mapas de cobertura florestal em formato compatível com o modelo MNEE, considerando os requisitos para simulação da SAD.",
    #2.2
    "Cálculo dos coeficientes da função de dispersão para ajustar a proporção de propágulos atingindo a vizinhança imediata do progenitor para cada valor de k.",
    # 3.
    "",
    # 3.1
    "Sorteio aleatório de sítios ao longo do gradiente de riqueza e abundância para análise do efeito escalar.",
    # 3.2
    "Cálculo da taxa U nas paisagens prístinas para 20 graus de limitação de dispersão (k) em extensões espaciais variando de 0,5 a 16 km de lado.",
    # 3.3
    "Avaliação da relação entre U, k, e a extensão da paisagem em cada sítio, utilizando estatísticas descritivas.",
    # 3.4
    "Identificação da extensão em que a taxa U estabiliza para cada grau de limitação de dispersão (k).",
    # 4.
    "",
    # 4.1
    "Construção de paisagens adequadas para cada nível de dispersão simulado (segundo passo 3.4).",
    # 4.2
    "Construção das paisagens hipotéticas com toda a cobertura florestal agregada ou preservada conforme as condições prístinas.",
    # 5.
    "",
    # 5.1
    "Estimativa da taxa U média por sítio e grau de limitação de dispersão (k).",
    # 5.2
    "Simulação de 100 réplicas de SADs contrafactuais para cada combinação de sítio, k, e U.",
    # 6.
    "",
    # 6.1
    "Cálculo do logaritmo da razão entre as taxas U estimadas nos contrafactuais para cada sítio e k.",
    # 6.2
    "Comparação entre SADs simuladas e observadas usando o teste Kolmogorov-Smirnov bootstrap.",
    # 7.
    "",
    # 7.1
    "Ajuste de 7 HGAMs com distribuições normais e método REML, variando nas preditoras e estrutura de suavização.",
    # 7.2
    "Comparação dos modelos via AICc, deviance explicada, e teste de autocorrelação espacial (Moran’s I) dos resíduos.",
    # 7.3
    "Baseada nos modelos mais plausíveis (>95% de peso de evidência), condicionada ao diagnóstico estatístico.",
    # 7.4
    "Geração de 1000 amostras das distribuições multivariadas dos coeficientes para predição, com resumo via quantis (5, 50 e 95%). Caso exista mais de um modelo plausível, então será feito a média de modelos baseado no peso de evidência"
  )
)

# Criando a tabela com flextable
library(dplyr)
library(flextable)
library(officer)
 
dados_tabela <- dados_tabela %>%
  mutate(Type = ifelse(grepl("^\\d\\. ", Procedimento), "Section", "Subsection"))

# Create the flextable
tabela <- flextable(dados_tabela) %>%
  set_header_labels(Procedimento = "Procedimento", Descricao = "Descrição") %>%
  merge_v(j = "Procedimento", part = "body") %>%
  width(j = c("Procedimento", "Descricao"), width = c(2, 6)) %>%
  align(j = "Procedimento", align = "left", part = "all") %>%
  align(j = "Descricao", align = "left", part = "all") %>%
  theme_vanilla()

# Apply distinct formatting to the sections
tabela <- tabela %>%
  bold(i = ~ Type == "Section", bold = TRUE, part = "body") %>%
  bg(i = ~ Type == "Section", bg = "#f4f4f4", part = "body") %>%
  fontsize(i = ~ Type == "Section", size = 12, part = "body") %>%
  border(i = ~ Type == "Section", border.bottom = fp_border(color = "black", width = 1))

# Remove the Type column for display
tabela <- tabela %>% delete_columns(j = "Type")

#
# tabela <- tabela %>%
#   bold(i = ~ Type == "Section", bold = TRUE, part = "body") %>%
#   bg(i = ~ Type == "Section", bg = "#f4f4f4", part = "body") %>%
#   fontsize(i = ~ Type == "Section", size = 12, part = "body") %>%
#   border(i = ~ Type == "Section", border.bottom = fp_border(color = "black", width = 1)) %>%
#   sjmisc::word_wrap(j = "Procedimento", i = ~ Type == "Section", part = "body", wrap = FALSE) %>%
#   sjmisc::word_wrap(j = "Descricao", i = ~ Type == "Section", part = "body", wrap = FALSE)

# Display the table
tabela
```


## Evidência empírica

<p>Selecionamos, na base de dados TreeCo, inventários florestais que amostraram indivíduos arbóreos com diâmetro à altura do peito (DBH) ≥ 4,8 cm, em parcelas únicas de pelo menos 1 ha de floresta. Selecionamos inventários com alta confiabilidade taxonômica tanto no nível de morfoespécie quanto na precisão da coordenada central da parcela. A base de dados TreeCo reuniu amplamente estudos fitossociológicos realizados na Floresta Atlântica (@de_lima_how_2015).</p> 
  
    
<p>Para caracterizar a cobertura vegetal, utilizamos os mapas da coleção 6 do MapBiomas com resolução de 30x30 m², que compilam dados anuais de 1985 a 2020 (@mapbiomas). Selecionamos o mapa de cobertura florestal mais próximo ao ano da amostragem de cada parcela para assegurar o pressuposto de contemporaneidade entre a amostragem da parcela e a cobertura florestal mapeada.</p>
  
    
<p>Cada mapa de cobertura foi recortado em quadrados centrados na coordenada central da parcela, com uma extensão máxima de 16x16 km². Para garantir uma correspondência entre a densidade de pixels do mapa e a densidade de indivíduos amostrados, ajustamos a resolução dos mapas. Pixels foram classificados como unidades de habitat se o valor de cobertura fosse ≥ 0,7 (observamos que, após o ajuste de resolução, surgiram valores intermediários entre 0 e 1, originalmente ausentes nos mapas binários).</p>  

  
<p>As parcelas foram delineadas como quadrados centralizados no mapa, alocando um total de N unidades de habitat, correspondendo ao número total de indivíduos na parcela. Quando não foi possível centralizar a parcela, ela foi deslocada ligeiramente para uma área adjacente que permitisse a demarcação de um quadrado adequado.</p>

## Validação Teórica

### Teoria Neutra da Biodiversidade

<p>O modelo neutro espacialmente explícito (MNEE) é parte de uma família de modelos fundamentados pela Teoria Neutra da Biodiversidade (TNB, @hubbell_unified_2011). Na TNB, modelos demográficos buscam reproduzir padrões de biodiversidade por meio de simulações que incorporam dinâmicas de morte, nascimento, dispersão e especiação de múltiplas espécies no espaço (@azaele_statistical_2016). No MNEE, a única interação entre os indivíduos é da competição neutra por espaço, o que resulta em flutuações estocásticas nos tamanhos populacionais das espécies, um processo conhecido como deriva ecológica (@azaele_statistical_2016).</p> 
  
<p>A TNB se desenvolveu em contraste com teorias que enfocam o componente adaptativo da biodiversidade, as quais consideram diferenças funcionais entre as espécies (@leroi_neutral_2020). Na TNB, assume-se a equivalência funcional, onde todas as espécies compartilham taxas demográficas per capita idênticas (@azaele_statistical_2016; @leroi_neutral_2020). A pesquisa dentro deste arcabouço teórico opera em dois eixos principais: (1) explorar pressupostos auxiliares que sustentam a equivalência funcional; e (2) investigar formas de relaxar esse pressuposto para acomodar variações propostas nos sistemas naturais (@ALONSO2006).</p>
    
      
<p>Uma das vantagens dos modelos neutros é sua capacidade de reproduzir padrões estáticos de biodiversidade local de maneira equivalente a modelos que incorporam diferenças entre espécies, mas com um número menor de parâmetros demográficos (@chisholm_niche_2010; @hammal_when_2015). Isso torna o MNEE particularmente útil como uma primeira aproximação em contextos de escassez de dados detalhados.</p>

### Modelo Neutro Espacialmente Explícito (MNEE)

<p>Uma característica central que o MNEE reproduz é a geometria estocástica dos indivíduos, na qual a distribuição espacial é probabilística e limitada, resultando em forte agregação de coespecíficos e influenciada pela configuração espacial (@McGill2010; @May2015, @may_abundance_2016). No MNEE, a dispersão é determinada tanto pela capacidade de dispersão dos propágulos quanto pela distância entre a fonte de propágulo e os habitats disponíveis (@rosindell_coalescence_2008). Ao replicar essa geometria estocástica de forma dinâmica, o MNEE assegura que a simulação expressa a conectividade entre a parcela amostrada e a paisagem circundante, refletindo a interação do espaço na competição entre indivíduos (@campos_neutral_2012, @campos_effect_2013).</p>
  
    
<p>O MNEE opera sob o pressuposto de equilíbrio dinâmico (@rosindell_coalescence_2008), alinhando-se ao pressuposto de contemporaneidade amplamente adotado na análise de dados observacionais pelos dois programas de pesquisa discutidos (ver Introdução). A situação de equilíbrio é atingida quando a taxa de extinção por deriva ecológica é compensada pela taxa de reposição de espécies (taxa U), que pode ocorrer via especiação, reposição do banco de propágulos, ou dispersão de longa distância de fora da paisagem (@condit_thirty_2012; @azaele_statistical_2016; @munoz_neutral_2016).</p>  
  
    
<p>A validade do MNEE foi testada em estudos de simulação que investigaram paisagens fragmentadas com diferentes níveis de perda de habitat e autocorrelação espacial (@campos_neutral_2012, @campos_effect_2013, @claudino_extinction_2015). Esses estudos demonstraram que a configuração espacial da cobertura florestal remanescente exerce um papel significativo na conformação da distribuição de abundância de espécies locais (SAD) simulada pelo MNEE (@campos_neutral_2012, @campos_effect_2013, @claudino_extinction_2015). Isso indica que o MNEE é sensível à estrutura espacial da paisagem, tornando-o uma ferramenta robusta para explorar a conectividade funcional em ecossistemas fragmentados.</p>

  
### Descrição da simulação de MNEE {#descricao-MNEE}
 
 
<p>O MNEE utiliza uma abordagem coalescente para modelar a dinâmica das comunidades ecológicas (@rosindell_coalescence_2008; @thompson_pycoalescence_2020). A simulação inicia sem informação prévia sobre a identidade das espécies presentes na parcela amostral. Durante a simulação, a cada passo temporal, um indivíduo da parcela é sorteado aleatoriamente para ser substituído. A substituição pode ocorrer de duas maneiras: (i) por um singleton, ou seja, um indivíduo de uma nova espécie que surge na paisagem com probabilidade U; ou (ii) pela prole de um adulto residente na paisagem, com probabilidade 1−U (@rosindell_coalescence_2008; @thompson_pycoalescence_2020). Nos casos em que a substituição ocorre por meio de um propágulo residente (1−U), o evento de dispersão é modelado através de um kernel de dispersão com distribuição exponencial espelhada, sendo i.i.d. (independentemente e identicamente distribuído) em duas dimensões (@bullock_synthesis_2017; @thompson_pycoalescence_2020). Para determinar a origem do propágulo, o modelo centraliza a função de dispersão no habitat vago e sorteia posições na paisagem até encontrar uma indivíduo adulto. O processo termina quando todos os indivíduos na parcela coalescem em um conjunto ancestral de indivíduos que são os primeiros de sua espécie na paisagem, criando uma árvore genealógica da comunidade local (@rosindell_coalescence_2008). Cada ramo dessa árvore é composto por indivíduos que compartilham um ancestral comum, representando a espécie que originalmente colonizou a paisagem. Isso permite a reconstrução da distribuição de abundância de espécies (SAD) a partir da árvore genealógica. A abordagem coalescente pressupõe que apenas um indivíduo pode ocupar uma unidade de habitat por vez, e que cada morte é imediatamente compensada pelo nascimento de um novo indivíduo adulto (pressuposto de soma zero, @rosindell_coalescence_2008).</p>  

  
<p>A capacidade de dispersão é controlada variando-se a proporção de propágulos que permanecem próximos à planta progenitora (i.e., distância até o vizinho imediato). A taxa U, que representa a probabilidade de introdução de novas espécies por nascimento, é estimada usando um método analítico proposto por @rosindell_coalescence_2008 (Apêndice A). Inicialmente, a simulação é executada com uma taxa U próxima de zero para simular uma árvore genealógica, e posteriormente utiliza-se uma equação para relacionar o número de espécies observadas com a taxa U média, permitindo uma calibração de MNEE com a riqueza de espécies observada (@rosindell_coalescence_2008, Apêndice A).</p>

## Calibração e validação empírica

<p>Nos estudos realizados pelos grupos de pesquisa que analisam dados observacionais, é comum utilizar a riqueza de espécies para ajustar e avaliar a congruência dos modelos estatísticos com os dados empíricos (e.g., @watling_support_2020; @puttker_indirect_2020). Neste trabalho, utilizamos a riqueza de espécies para calibrar a taxa U do mecanismo demográfico representado no MNEE (ver 'validação teórica') e a Distribuição de Abundância de Espécies (Species Abundance Distribution, SAD) para validar empiricamente o resultado dessa simulação.</p>
  
    
<p>Uma vez estimada a taxa U necessária para simular a riqueza observada na paisagem contrafactual específica e grau de limitação de dispersão, a SAD é simulada sob o mesmo cenário contrafactual. A validação com a SAD observada é realizada por meio de um teste de hipótese, que classifica a forma da SAD simulada como congruente ou não congruente com a SAD empírica.</p>

   
<p>A taxa U pode ser ajustada diretamente pelo MNEE para refletir a riqueza de espécies observada na paisagem (@rosindell_coalescence_2008). Ao calibrar corretamente a riqueza nas paisagens contrafactuais, a SAD simulada é projetada para ter o mesmo número de indivíduos e uma quantidade aproximada de espécies em relação à SAD observada. Assim, quaisquer divergências na forma da SAD simulada podem ser atribuídas principalmente à variação na distribuição da abundância relativa das espécies, e não ao número total de espécies ou indivíduos. Isso é relevante porque, para um dado número de espécies e indivíduos, existem múltiplas formas possíveis para a SAD (@locey_how_2013). Portanto, é esperado algum grau de variação natural entre as SAD simuladas e observadas devido à diversidade intrínseca de formas que a SAD pode assumir.</p>
  
    
<p>Esse design de simulação procura calibrar o mecanismo demográfico de baixo nível que interage diretamente com a configuração da paisagem, enquanto, a validação empírica é feita no nível do padrão emergente resultante desse mecanismo. Dessa forma, a informação usada na calibração e validação possuem graus de distinção, critério necessário para usar modelos baseados em indivíduos como representantes de mecanismos (@gianluca_ch4_2022).</p>
  
    
<p>Para a validação empírica comparamos a congruência entre a SAD observada e simulada a partir do teste de hipótese Kolmogorov-Smirnov bootstrap (@dowd_twosamples_2023). Esse teste tem pressupõe hipótese nula de que os dois vetores em comparação (SAD observada e SAD simulada) são amostras de uma mesma distribuição teórica; a estatística de interesse do teste é a maior diferença entre as curvas acumuladas das SAD (@dowd_twosamples_2023). Contabilizamos o número de SAD simuladas que são congruentes com a SAD observada para cada sítio, paisagem contrafactual e nível de limitação de dispersão considerado.</p>

## Análise dos Dados 

### Lógica contrafactual para estimar os propostos efeitos da paisagem a partir do contraste de simulações de dinâmicas demográficas no espaço

<p>O método proposto permite formular frases como: “A SAD simulada na paisagem contemporânea, em relação à SAD simulada na paisagem prístina, indica uma redução na conectividade local na ordem de __log⁡(U/U)__ e apresenta uma melhora/piora na congruência com a SAD observada na ordem de __log⁡(OR)__, __de acordo com o pressuposto do MNEE e o grau de limitação de dispersão simulado__.” Esses termos em negrito facilitam a interpretação, atribuição e generalização dos efeitos estimados, seja para cada sítio de amostragem individual ou para um efeito médio comum. Essa estrutura de frase pode ser utilizada para descrever o efeito de fragmentação total, conforme pressuposto de interdependência (tabela 1 e box 1, introdução). Para os efeitos da paisagem sob o pressuposto de independência, temos uma frase por efeito, cada uma comparando pares de SADs contrafactuais distintos: fragmentação per se, comparando as paisagens contemporânea e aglomerada; e área per se, comparando as paisagens aglomerada e prístina (ver tabela 1, introdução).</p>
  
    
<p>Esses efeitos são estimados para cada sítio de amostragem da base TreeCo dentro do critério de inclusão. Por sítio de amostragem e paisagem contrafactual, foram simulados 20 graus de limitação de dispersão. A proporção de propágulos que permanecem na vizinhança imediata da planta progenitora (k) variou de 0,99 (limitação de dispersão severa) a 0,05 (limitação de dispersão branda). Para cada conjunto de simulações (combinando sítio de amostragem, paisagem contrafactual e k), estimamos 10 réplicas da taxa U necessária para manter a riqueza observada. A média dessas estimativas de U foi utilizada para parametrizar 100 simulações adicionais, as quais foram usadas para simular a Distribuição de Abundância de Espécies (SAD).</p>
  
    
<p>Nas próximas seções, detalhamos a interpretação do contraste na taxa U (log⁡(U/U)) como uma métrica funcional de conectividade local (\@ref(interpretacao)). Em seguida, descrevemos como atribuimos os efeitos propostos na congruência com a evidência empírica, ou seja, com a SAD observada (\@ref(atribuicao)). Por fim, argumentamos sobre a generalização dessa estimativa, ponderando o modelo mecanístico empregado e a escala do mecanismo, que é determinada pela capacidade de dispersão (\@ref(generalizacao)).</p>


### Interpretação {#interpretacao}
 
<p>Nós interpretamos log⁡(U/U) como uma métrica que reflete a proposta influência da paisagem na riqueza local de espécies. A influência da paisagem na abundância relativa das espécies locais está, em algum grau, associada à sua influência na riqueza local (@jackson_are_2015, @fletcher_jr_addressing_2023), a qual é descrita pela taxa U. O contraste das taxas U estimadas entre diferentes pares de paisagens contrafactuais permite compreender como a diferença entre essas paisagens afeta a riqueza local. Para um dado sítio e grau de limitação de dispersão (k), quanto menor for a taxa U necessária para obter a riqueza observada, maior será a reposição simulada de espécies por meio da imigração de propágulos vindos da paisagem circundante para a parcela (@may_dispersal_2012). Assim, o logaritmo da razão entre as taxas U ( log⁡(U/U) ) indica em qual paisagem contrafactual a dependência da imigração de espécies da paisagem circundante é maior.</p>
  
    
<p>Quando log⁡(U/U) é igual a zero, enão não há diferença entre os contrafactuais em relação à reposição de espécies locais pela paisagem. Se o valor for positivo, significa que a paisagem contrafactual no numerador tem uma taxa U mais elevada, indicando uma maior demanda de reposição de espécies locais pela paisagem. Por outro lado, se o valor for negativo, a paisagem no numerador apresenta uma menor demanda de reposição de espécies locais, sugerindo uma maior autossuficiência em termos de riqueza local.</p>


### Atribuição {#atribuicao}

<p>A atribuição dos efeitos da paisagem é realizada comparativamente, analisando o contraste entre paisagens contrafactuais em termos de variação na congruência com a distribuição de abundância de espécies (SAD) observada. O processo de avaliação da congruência entre a SAD factual e as SADs simuladas contrafactuais foi realizado em etapas. Primeiro, foi calculada a proporção de SADs simuladas que apresentam boa congruência com a SAD observada para cada sítio de amostragem, grau de limitação de dispersão, e paisagem contrafactual. Em seguida, foi calculado o logaritmo da razão de chances (log odds ratio, log⁡OR) para os contrastes de paisagens contrafactuais propostos (ver Tabela 1 e box 1), agregados por sítio de amostragem e grau de limitação de dispersão. Quando a congruência da SAD simulada é igual para ambos os contrafactuais, o valor de log⁡OR é zero. Se a paisagem contrafactual no numerador apresenta maior proporção de SADs congruentes, então log⁡OR será maior que zero; caso contrário, será negativo.</p>


<p>O design de simulação empregado para estimar esses efeitos de contraste entre paisagens na congruência com a SAD observada introduz uma estrutura hierárquica aos dados, pois simula múltiplos cenários de dispersão para cada combinação de contrafactual e sítio de amostragem. Em situações onde os dados possuem uma estrutura hierárquica, é possível estimar efeitos causais não enviesados (@Feller2015; @weinstein2024). A lógica subjacente é que, se o sítio de amostragem é mantido constante, então todas as possíveis covariáveis fixas são controladas implicitamente (@Marshall2014; @DAGinf_epi_2019; @weinstein2024). Nesse contexto, é possível modelar a variabilidade em log⁡OR usando um modelo hierárquico de regressão, interpretando a predição deste modelo como uma síntese do efeito causal empírico representado por log⁡OR ( @Feller2015 ;@grace2024 ). O objetivo é compreender essa variabilidade em termos de princípios organizadores e métricas interpretáveis.</p>


#### Descrição estatística dos efeitos da paisagem na congruência da simulação com o padrão empírico {#efeito-congruencia}

<p>Os efeitos causais médios da paisagem foram descritos com modelos hierárquicos aditivos generalizados (HGAM; @Pedersen2019), com log⁡OR como variável resposta em função do logaritmo da razão das taxas U (log⁡(U/U) e da proporção de propágulos que permanecem na vizinhança imediata (k). Com até esse conjunto de preditores em interação, esperamos compreender a variabilidade dos efeitos causais estimados, separando a variabilidade associada ao sítio de amostragem daquela que é comum entre todos os sítios (@Pedersen2019). Os HGAMs foram ajustados usando funções do pacote mgcv (@wood2011) com distribuição gaussiana (detalhes em Material Suplementar). Nós incluímos como preditora a capacidade de dispersão simulada, além da métrica funcional de influência da paisagem na riqueza, para representar qualquer efeito da paisagem na abundância relativa não contemplado pelo efeito da métrica funcional.</p> 
 
<p>Para cada efeito causal médio da paisagem (área per se, fragmentação per se e fragmentação total), comparamos, via AICc (@burnham1998practical), 7 modelos hierarquicos aditivos generalizados (tabela X): i) com um tensor entre k e logU/U comum e com um tensor dessas duas variáveis por sítio de amostragem (com o tensor por sítio compartilhando o parâmetro de penalizado com o tensor comum); ii) com um tensor entre k e logU/U comum e apenas um intercepto por sítio; iii) 1 spline comum para logU/U e com um spline por sítio (compartilhando a penalização); iv) 1 spline para logU/U e com apenas 1 intercepto por sítio; v) 1 spline comum para k e por sítio (compartilhando a penalização); vi) 1 spline comum para k e apenas 1 intercepto por sítio; vii) 1 intercepto comum e por sítio.</p> 



```{r criacao da tabela de descricao dos modelos, eval=TRUE,include=TRUE,tab.cap="Sumário dos modelos hierarquicos aditividos generalizados usados para descrever os propostos efeitos da paisagem."}
library(gt)
library(webshot2)
# Data for the table
model_data <- data.frame(
  HGAM = 1:7,
  Tipo_de_Efeito = c("Tensor", "Tensor", "Spline", "Spline", "Spline", "Spline", "Intercepto"),
  Variables = c("k, logU/U", "k, logU/U", "logU/U", "logU/U", "k", "k", "Nenhuma"),
  Site_Specific_Effect = c("Tensor por sítio (mesma penalização)",
                                  "Intercepto por sítio",
                                  "Spline por sítio (mesma penalização)",
                                  "Intercepto por sítio",
                                  "Spline por sítio (mesma penalização)",
                                  "Intercepto por sítio",
                                  "Intercepto por sítio"),
  Description = c("Tensor compartilhado para k e logU/U entre os sítios, com um tensor adicional para cada sítio (mesma penalização).",
                "Tensor compartilhado para k e logU/U entre os sítios, com um intercepto individual por sítio.",
                "Spline compartilhado para logU/U entre os sítios, com um spline adicional para cada sítio (mesma penalização).",
                "Spline compartilhado para logU/U entre os sítios, com um intercepto individual por sítio.",
                "Spline compartilhado para k entre os sítios, com um spline adicional para cada sítio (mesma penalização).",
                "Spline compartilhado para k entre os sítios, com um intercepto individual por sítio.",
                "Modelo simples de intercepto com intercepto comum e específico por sítio.")
)
# Create the table using gt
gt_table <- gt(model_data) %>%
  # tab_header(
  #   title = "Summary of Models",
  #   subtitle = "7 Generalized Additive Hierarchical Models"
  # ) %>%
  cols_label(
    HGAM = "HGAM",
    Tipo_de_Efeito = "Efeito",
    Variables = "Preditoras",
    Site_Specific_Effect = "Efeitos por Sítio ",
    Description = "Descrição"
  ) %>%
  tab_footnote(
    footnote = "HGAM: sigla em inglês para Hierarchical Generalized Additive Models como em Pedersen et al. (2019)."
    )%>% 
  cols_width(
    HGAM ~ px(50),                      # Set specific width for the 'HGAM' column
    Tipo_de_Efeito ~ px(75),           # Adjust width for 'Tipo de Efeito'
    Variables ~ px(75),                # Adjust width for 'Preditoras'
    Site_Specific_Effect ~ px(150),     # Adjust width for 'Efeitos por Sítio'
    Description ~ px(450)               # Adjust width for 'Descrição'
  ) %>% 
  tab_options(
    # table.width = px(400),
    table.font.size = 12
  )
# Display the gt table
gt_table
# # Save the table as a PNG file
# gtsave(gt_table, paste0(v_path,"figuras/tabela_descricao_modelos_hgam.png"))
```


### Generalização {#generalizacao}

<p>Um ponto de discordância entre os programas de pesquisa é a escala espacial adequada para analisar a relação entre a perda de cobertura florestal e a biodiversidade remanescente (ver Introdução). Em nossa metodologia, consideramos o efeito escalar da dispersão no  mecanismo demográfico simulado e então buscamos determinar a extensão espacial da análise de acordo. Na construção da paisagem contrafactual aglomerada, onde todo o habitat remanescente é aglomerado ao redor da parcela amostrada, a extensão espacial da paisagem determina a quantidade de habitat que será agregado (@valente_toward_2023). O processo gerador da SAD factual não é conhecido, e, portanto, não se sabe quais mecanismos estão envolvidos nem as escalas desses mecanismos (@fletcher_jr_addressing_2023; @jackson_are_2015). Para incluir essa incerteza, simulamos diversos graus de limitação de dispersão, uma vez que a capacidade de dispersão aumenta a área necessária para simular a árvore genealógica da comunidade ((\@ref(descricao-MNEE))). Nós buscamos ajustar a extensão espacial da paisagem para que a estimativa da taxa U não sofra interferência do recorte do mapa de cobertura florestal. Uma expectativa é que a redução da limitação de dispersão aumente a extensão espacial suficiente para simular a dinâmica coalescente.</p>

<p>Para avaliar a escala espacial adequada investigamos em paisagens prístinas o comportamento da taxa U sob o aumento da extensão espacial da paisagem ao redor. Quando o Modelo Neutro Espacialmente Explícito (MNEE) simula a dinâmica coalescente em paisagens infinitas e sem perda de habitat, a taxa U necessária para manter a riqueza na parcela apresenta um máximo global quando o grau de limitação de dispersão é moderado (@may_dispersal_2012). Para graus severos de limitação à dispersão, a taxa U estimada em MNEE é baixa, pois a perda de espécies é pequena: a maior parte das substituições ocorre entre coespecíficos (@may_dispersal_2012). Com o relaxamento da limitação de dispersão, a perda de espécies aumenta, pois a substituição de coespecíficos diminui, e a perda de espécies por deriva ecológica se torna mais expressiva (@may_dispersal_2012). Com o aumento da capacidade de dispersão além de graus moderados, há maior contribuição de subpopulações mais distantes da parcela, o que reduz novamente a estimativa da taxa U, porém à custa de uma maior homogenização na escala da paisagem (@Mouquet2003Community).</p>

<p>Investigamos como a variação na escala espacial da paisagem interfere na estimativa da taxa U para cada grau de limitação de dispersão simulado. Para isso, sorteamos 30 sítios entre os selecionados e simulamos a taxa U na paisagem prístina, variando a extensão espacial da paisagem entre 0,5 km e 16 km de lado para os 20 graus de limitação de dispersão (k). Descrevemos a variação na estimativa de U em função de k e da extensão espacial da paisagem. Espera-se que o aumento da extensão espacial da paisagem reduza a estimativa da taxa U cada vez menos até que incrementos na extensão espacial não resultem em redução na taxa U. Assim, a extensão espacial considerada "suficiente" foi definida como aquela que acumulou 95% de toda a variação observada entre as extensões de 0.5 km e 16 km (detalhes no Apêndice 1: Efeito Escalar).</p>

<p>Para descrever a variação na taxa U associada à variação na extensão espacial para um determinado grau de limitação de dispersão, exploramos um modelo gaussiano em que a taxa U média pode ser descrita em função do número de espécies e indivíduos (na escala log) e do grau de limitação de dispersão e da extensão espacial (como variáveis categóricas) com um intercepto aleatório por sítio de amostragem (detalhes no apêndice ‘Efeito de Escalar’). Avaliamos, por grau de limitação de dispersão, como a média variou em função do aumento da extensão espacial da paisagem. A escala que acumulou a maior parte da variação total (de aumentar o lado da paisagem local de 0.5 km até 16 km) foi considerada como escala adequada para aquele grau de limitação de dispersão. Essa abordagem pressupõe que o efeito de escalar é monotônico.</p> 

# Referências