---
title: "Trabalho em Andamento"
author: "Danilo Pereira Mori"
date: "2024-02-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 14 jul 2024

Moran test for spatial autocorrelation

```{r}
library(spdep)
dfmd <- md$model
dfmd$residuals <- residuals(md)
dfmd_avgbySite <- dfmd %>% 
  group_by(SiteCode) %>% 
  summarise(mean_res = mean(residuals),
            lat = first(lat),
            long = first(long)) %>% 
  ungroup()
# Prepare spatial data
coordinates <- dfmd_avgbySite[, c("lat","long")]
coordinates <- as.matrix(coordinates)
nb <- knn2nb(knearneigh(coordinates, k=4))  
listw <- nb2listw(nb)
# Calculate Moran's I for residuals
moran_output <- moran.test(dfmd_avgbySite$mean_res, listw)
data.frame(
  Statistic = c(
    "Moran I statistic", 
    "Expectation", 
    "Variance", 
    "Standard Deviate", 
    "p-value"
    ),
  Value = c(
    moran_output$estimate[["Moran I statistic"]], 
    moran_output$estimate[["Expectation"]], 
    moran_output$estimate[["Variance"]], 
    moran_output$statistic, 
    moran_output$p.value
    )
) %>% pivot_wider(names_from=Statistic,values_from = Value)
```




# 21jun2024

```{r}
df_aud <- df_contrastes %>%
  select(SiteCode:p, contains("_logratio")) %>% 
  mutate(across(-SiteCode,f_z,.names = "{.col}_z"))
l_p <- list()
l_p$padrao <- 
  df_aud %>% 
  ggplot(aes(x=area_logratio_z,y=frag.total_logratio_z)) +
  geom_point() +
  labs(title="Escala Padrão") +
  geom_abline(slope=1,intercept = 0,color="darkred") +
  theme(aspect.ratio = 1)
l_p$z <- 
  df_aud %>% 
  ggplot(aes(x=area_logratio_z,y=frag.total_logratio_z)) +
  geom_point() +
  labs(title="z transformada") +
  geom_abline(slope=1,intercept = 0,color="darkred") +
  theme(aspect.ratio = 1)
grid.arrange(grobs=l_p,nrow=1)
df_aud %>% 
  select(area_logratio,frag.total_logratio) %>% 
  pivot_longer(cols = everything()) %>% 
  ggplot(aes(x=name,y=value)) +
  geom_boxplot() +
  geom_jitter()

```



# 20jun2024

```{r}
df_logOR %>% 
  select(-matches("^k|^p(!pristine)")) %>% 
  pivot_longer(cols = c("itself","pristine","numerator","denominator"),
               values_to="logOR",
               names_to="taxaU") %>% 
  mutate(taxaU = factor(taxaU,
                        levels=c("itself","pristine","numerator","denominator"))) %>% 
  ggplot(aes(x=Uefeito,y=logOR,color=taxaU,group=SiteCode)) +
  geom_hline(yintercept = 0,color="gray") +
  geom_vline(xintercept = 0,color="gray") +
  geom_line(alpha=0.2) +
  geom_point(alpha=0.2) +
  scale_color_manual(values=c("darkred","darkgreen","darkblue","darkorange")) +
  facet_grid(taxaU~contraste)
```



# 17/jun/2024

Os modelos para descrever os GAMMS pareciam precisar de maior grau de liberdade para descrever os padrões por sítios de amostragem. Interpretei que os dados sugerem que no caso 




# 15/06/2024

```{r}
v_num_itself <- dfi[dfi$taxaU==unname(cpair["numerador"]),
    c("SiteCode","k",cpair["numerador"],"taxaU")] %>% pull(contemp)
v_deno_itself <- dfi[dfi$taxaU==unname(cpair["denominador"]),
    c("SiteCode","k",cpair["denominador"],"taxaU")] %>% pull(ideal)
v_itself <- v_num_itself - v_deno_itself


dfi %>% head
dfi %>% filter(taxaU==uname(cpair["ideal"])) %>% pull(contemp)


```




# 4 mar 2024

Revisão dos resultados para avaliação da adequação


# 27fev2024




# 26fev2024

Anteriormente, 
simulei as SADs preditas nas paisagens contemporâneas e aglomeradas. Agora irei continuar as análises das SADs preditas nas paisagens contemporânea e aglomerada com o U prístino. 

Ontem fiz o pedido de prorrogação por conta da influência da pandemia.